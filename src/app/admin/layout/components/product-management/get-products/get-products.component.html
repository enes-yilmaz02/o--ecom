<div class="card">
  <h2>{{ "dGetorders.headerproduct" | transloco }}</h2>
  <div>
    <div class="category-filter flex">
      <div class="card flex flex-row justify-content-center">
        <form [formGroup]="categoryForm" class="form-content">
          <div class="drpdwn">
            <select formControlName="category" (change)="onCategoryChange()">
              <option value="" disabled selected hidden>{{'dGetorders.filterCategory' |transloco}}</option>
              <option *ngFor="let category of categories" [value]="category.name">
                {{ category.name | transloco }}
              </option>
            </select>
          </div>
          <div class="drpdwn">
            <select formControlName="status" (change)="onStatusChange()">
              <option value="" disabled selected hidden>{{'dGetorders.filterStatus' |transloco}} </option>
              <option *ngFor="let sts of status" [value]="sts.name">
                {{ sts.name | transloco }}
              </option>
            </select>
          </div>
          <div class="drpdwn">
            <select formControlName="price" (change)="onPriceChange()">
              <option value="" disabled selected hidden>{{'dGetorders.filterPrice' |transloco}}</option>
              <option *ngFor="let price of priceCategories" [value]="price.range">
                {{ price.name | transloco }}
              </option>
            </select>
          </div>
          <div class="drpdwn">
            <select formControlName="rating" (change)="onRatingChange()">
              <option value="" disabled selected hidden>{{'dGetorders.filterRating' |transloco}}</option>
              <option *ngFor="let rtg of rating" [value]="rtg.value">
                {{ rtg.name | transloco }}
              </option>
            </select>
          </div>
        </form>
      </div>
    </div>
  </div>
  <p-table
    [value]="products"
    dataKey="name"
    [loading]="isLoading.value"
    [rows]="10"
    [rowsPerPageOptions]="[10, 25, 50]"
    [paginator]="true"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
    [tableStyle]="{ 'min-width': '60rem' }"
  >
    <ng-template pTemplate="header">
      <tr class="main">
        <th pSortableColumn="name">{{ "aGetProduct.name" | transloco }}</th>
        <th>{{ "aGetProduct.image" | transloco }}</th>
        <th pSortableColumn="price">{{ "aGetProduct.price" | transloco }}</th>
        <th pSortableColumn="category">
          {{ "aGetProduct.category" | transloco }}
        </th>
        <th pSortableColumn="rating">{{ "aGetProduct.rating" | transloco }}</th>
        <th pSortableColumn="inventoryStatus">
          {{ "aGetProduct.status" | transloco }}
        </th>
        <th>{{ "aGetProduct.actions" | transloco }}</th>
      </tr>
    </ng-template>
    <ng-template
      pTemplate="body"
      let-product
      let-expanded="expanded"
      let-editing="editing"
      let-ri="rowIndex"
    >
      <tr [pEditableRow]="product">
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="text" [(ngModel)]="product.name" />
            </ng-template>
            <ng-template pTemplate="output">
              {{ product.name }}
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input pInputText type="file" [(ngModel)]="product.file" />
            </ng-template>
            <ng-template pTemplate="output">
              <img
                [src]="getFileUrl(product?.file)"
                [alt]="product.name"
                width="50"
                class="shadow-4"
              />
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input
                pInputText
                type="text"
                [(ngModel)]="product.priceStacked"
              />
            </ng-template>
            <ng-template pTemplate="output">
              {{ product.priceStacked | currency : "USD" }}
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input
                pInputText
                type="text"
                [(ngModel)]="product.category"
              />
            </ng-template>
            <ng-template pTemplate="output">
              {{ product.category | categoryStatus }}
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <p-rating
            [ngModel]="product.valueRating"
            [readonly]="true"
            [cancel]="false"
          ></p-rating>
        </td>
        <td>
          <p-cellEditor>
            <ng-template pTemplate="input">
              <input
                pInputText
                type="text"
                [(ngModel)]="product.selectedStatus.name"
              />
            </ng-template>
            <ng-template pTemplate="output">
              <p-tag
                [value]="product.selectedStatus.name | stockStatus"
                [severity]="getSeverity(product.selectedStatus.name)"
              ></p-tag>
            </ng-template>
          </p-cellEditor>
        </td>
        <td>
          <div class="flex align-items-center justify-content-center gap-2">
            <button
              pButton
              pRipple
              type="button"
              icon="pi pi-trash"
              (click)="deleteProduct(product)"
              class="p-button-rounded p-button-text trash"
            ></button>
          </div>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="7">{{ "aGetOrders.nf" | transloco }}</td>
      </tr>
    </ng-template>
  </p-table>
</div>
